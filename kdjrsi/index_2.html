<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>KDJ + RSI æ™ºèƒ½åˆ¤æ–­å·¥å…·</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* --- ä» è±†æµ†åŠ©æ‰‹ è¿ç§»çš„æ ¸å¿ƒ iOS é£æ ¼ --- */
    :root {
      --ios-blue: #007AFF;
      --ios-red: #FF3B30;
      --ios-green: #34C759;
      --ios-gray: #8E8E93;
      --ios-light-gray: #F2F2F7;
      --ios-extra-light-gray: #F9F9F9;
      --ios-border: rgba(60, 60, 67, 0.1);
      --ios-text-primary: #111111;
      --ios-text-secondary: #3a3a3c;
      --ios-text-tertiary: #6e6e73;
    }

    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", system-ui, sans-serif;
      max-width: 500px;
      margin: 0 auto;
      padding: 20px;
      background-color: var(--ios-light-gray);
      font-size: 17px;
      color: var(--ios-text-primary);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    .ios-card {
      background: #FFFFFF;
      border-radius: 14px;
      padding: 24px 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .ios-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--ios-text-primary);
      text-align: center;
      margin-bottom: 28px;
      letter-spacing: -0.02em;
    }

    .ios-form-group {
      margin-bottom: 22px;
      position: relative;
    }

    .ios-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--ios-text-secondary);
      font-size: 17px;
    }

    .ios-select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--ios-border);
      border-radius: 10px;
      font-size: 17px;
      background-color: #FFFFFF;
      -webkit-appearance: none;
      appearance: none;
      color: var(--ios-text-primary);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      background-size: 12px;
      cursor: pointer;
    }

    .ios-select:focus {
      outline: none;
      border-color: var(--ios-blue);
      box-shadow: 0 0 0 1px var(--ios-blue);
    }

    .ios-button {
      background: var(--ios-blue);
      color: white;
      border: none;
      padding: 14px;
      width: 100%;
      border-radius: 10px;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 12px;
      transition: background-color 0.2s, transform 0.1s;
    }

    .ios-button:active {
      opacity: 0.9;
      transform: scale(0.98);
    }

    .ios-result {
      display: none; /* é»˜è®¤éšè— */
      padding-top: 24px;
      border-top: 1px solid var(--ios-border);
      margin-top: 32px;
    }

    .ios-suggestion {
      margin-top: 16px;
      padding: 20px; /* ä¼˜åŒ–ï¼šå¢åŠ å†…è¾¹è·ï¼Œæä¾›å‘¼å¸æ„Ÿ */
      background: rgba(0, 122, 255, 0.06);
      border-radius: 14px;
      white-space: pre-line; /* ä¿æŒæ¢è¡Œ */
    }

    .ios-suggestion-title {
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--ios-blue);
      font-size: 17px;
    }

    /* ä¼˜åŒ–ï¼šä¸ºç»“æœæ–‡æœ¬åˆ›å»ºç‹¬ç«‹çš„æ ·å¼è§„åˆ™ */
    .ios-suggestion p {
      margin: 0; /* æ¸…é™¤ p æ ‡ç­¾çš„é»˜è®¤å¤–è¾¹è· */
      font-size: 16px; /* ç•¥å¾®ç¼©å°å­—å·ï¼Œä¸æ ‡é¢˜å½¢æˆå¯¹æ¯” */
      color: var(--ios-text-secondary); /* ä½¿ç”¨æ¬¡çº§æ–‡æœ¬é¢œè‰²ï¼Œä¿æŒä¸€è‡´æ€§ */
      line-height: 1.6;
    }

    .chart-note {
      font-size: 14px;
      text-align: center;
      color: var(--ios-text-tertiary);
      margin-top: 16px;
    }

    canvas {
      margin-top: 24px;
    }
  </style>
</head>
<body>
<div class="ios-card">
  <h1 class="ios-title">KDJ + RSI + MACD æ™ºèƒ½åˆ†æ</h1>

  <div class="ios-form-group">
    <label for="j" class="ios-label">J å€¼ (çŸ­æœŸå¼ºå¼±)</label>
    <select id="j" class="ios-select">
      <option value="">è¯·é€‰æ‹© J å€¼</option>
      <option value="-30">-30 (æåº¦è¶…å–)</option>
      <option value="-20">-20 (æå¼±)</option>
      <option value="-10">-10 (åå¼±)</option>
      <option value="0">0 (æä½)</option>
      <option value="10">10 (ä½ä½)</option>
      <option value="20">20 (åä½)</option>
      <option value="30">30 (ä¸­ä½)</option>
      <option value="40">40 (ä¸­ç­‰)</option>
      <option value="50">50 (ä¸­æ€§)</option>
      <option value="60">60 (ç•¥å¼º)</option>
      <option value="70">70 (åé«˜)</option>
      <option value="80">80 (å¼ºåŠ¿)</option>
      <option value="90">90 (è¶…ä¹°)</option>
      <option value="100">100 (æå¼º)</option>
      <option value="110">110 (è¿‡çƒ­)</option>
    </select>
  </div>

  <div class="ios-form-group">
    <label for="rsi" class="ios-label">RSI å€¼ (ä¹°å–å¼ºåº¦)</label>
    <select id="rsi" class="ios-select">
      <option value="">è¯·é€‰æ‹© RSI å€¼</option>
      <option value="-10">-10 (å¼‚å¸¸æå¼±)</option>
      <option value="0">0 (æå¼±)</option>
      <option value="10">10 (è¶…å–)</option>
      <option value="20">20 (åå¼±)</option>
      <option value="30">30 (ä½ä½)</option>
      <option value="40">40 (ä¸­ä½)</option>
      <option value="50">50 (ä¸­æ€§)</option>
      <option value="60">60 (ä¸­å¼º)</option>
      <option value="70">70 (åå¼º)</option>
      <option value="80">80 (è¶…ä¹°)</option>
      <option value="90">90 (å¼ºåŠ¿)</option>
      <option value="100">100 (æå¼º)</option>
    </select>
  </div>

  <div class="ios-form-group">
    <label for="volume" class="ios-label">æˆäº¤é‡çŠ¶æ€ (ä¸å‡é‡å¯¹æ¯”)</label>
    <select id="volume" class="ios-select">
      <option value="">è¯·é€‰æ‹©æˆäº¤é‡çŠ¶æ€</option>
      <option value="low">ç¼©é‡ (<0.7å€)</option>
      <option value="normal">ä¸­æ€§ (â‰ˆå‡é‡)</option>
      <option value="high">æ”¾é‡ (>1.5å€)</option>
    </select>
  </div>

  <div class="ios-form-group">
    <label for="cycle" class="ios-label">åˆ†æå‘¨æœŸ</label>
    <select id="cycle" class="ios-select">
      <option value="day">æ—¥K</option>
      <option value="week">å‘¨K</option>
      <option value="hour">å°æ—¶K</option>
    </select>
  </div>

  <div class="ios-form-group">
    <label for="macd" class="ios-label">MACD ä¿¡å· (è¾…åŠ©å‚è€ƒ)</label>
    <select id="macd" class="ios-select">
      <option value="">è¯·é€‰æ‹© MACD çŠ¶æ€</option>
      <option value="golden-cross-above">é‡‘å‰ï¼ˆ0è½´ä¸Šï¼‰</option>
      <option value="golden-cross-below">é‡‘å‰ï¼ˆ0è½´ä¸‹ï¼‰</option>
      <option value="dead-cross">æ­»å‰</option>
      <option value="red-bar-shrink">çº¢æŸ±ç¼©çŸ­</option>
      <option value="top-divergence">é¡¶èƒŒç¦»</option>
      <option value="bottom-divergence">åº•èƒŒç¦»</option>
    </select>
  </div>

  <button class="ios-button" onclick="judgeSignal()">æ™ºèƒ½åˆ¤æ–­</button>

  <div id="result-container" class="ios-result">
    <div class="ios-suggestion">
      <div class="ios-suggestion-title">æ™ºèƒ½åˆ†æç»“æœ</div>
      <p id="result-text"></p>
    </div>
    <canvas id="previewChart" height="200"></canvas>
  </div>
</div>

<script>
  function judgeSignal() {
    const j = parseFloat(document.getElementById("j").value);
    const rsi = parseFloat(document.getElementById("rsi").value);
    const volume = document.getElementById("volume").value;
    const cycle = document.getElementById("cycle").value;
    const macd = document.getElementById("macd").value;
    const resultContainer = document.getElementById("result-container");
    const resultTextBox = document.getElementById("result-text");

    if (isNaN(j) || isNaN(rsi)) {
      alert("âš ï¸ è¯·å®Œæ•´é€‰æ‹©æ‰€æœ‰å‚æ•°");
      return;
    }

    let signal = "ğŸ“Š å½“å‰å¸‚åœºæš‚æ— æ˜æ˜¾ä¿¡å·ï¼Œå»ºè®®è€å¿ƒè§‚å¯Ÿï¼Œä¸å®œè´¸ç„¶æ“ä½œã€‚";

    // é¡¶éƒ¨åˆ¤æ–­
    const isTop = (j >= 90 && rsi >= 70) ||
            (j >= 80 && rsi >= 60 && macd === "dead-cross") ||
            (macd === "top-divergence" || macd === "red-bar-shrink") ||
            (volume === "low" && j > 70 && rsi > 60);

    if (isTop) {
      const details = [];
      if (j >= 90 && rsi >= 70) details.push("â€¢ KDJ ä¸ RSI æ˜æ˜¾è¶…ä¹°");
      if (macd === "dead-cross") details.push("â€¢ MACD æ­»å‰ï¼ŒåŠ¨èƒ½è¡°ç«­");
      if (macd === "top-divergence") details.push("â€¢ å‡ºç°é¡¶èƒŒç¦»ä¿¡å·");
      if (macd === "red-bar-shrink") details.push("â€¢ çº¢æŸ±ç¼©çŸ­ï¼ŒåŠ¨èƒ½å‡å¼±");
      if (volume === "low" && j > 70 && rsi > 60) details.push("â€¢ ä¸Šæ¶¨ç¼©é‡ï¼Œæˆ–ä¸ºè¯±å¤š");
      signal = "ğŸ“ˆ å¤šé¡¹æŒ‡æ ‡æ˜¾ç¤ºå¸‚åœºå¤„äºç›¸å¯¹é«˜ä½ï¼š\n\n" + details.join("\n") + "\n\nâš ï¸ å»ºè®®é€æ­¥æ­¢ç›ˆï¼Œé˜²èŒƒå†²é«˜å›è½ã€‚";
    }

    // åº•éƒ¨åˆ¤æ–­
    const isBottom = (j <= 10 && rsi <= 30) ||
            (j <= 20 && rsi <= 40 && macd === "golden-cross-below") ||
            (macd === "bottom-divergence") ||
            (volume === "high" && j < 30 && rsi < 50);

    if (isBottom) {
      const details = [];
      if (j <= 10 && rsi <= 30) details.push("â€¢ KDJ ä¸ RSI æ˜æ˜¾è¶…å–");
      if (macd === "golden-cross-below") details.push("â€¢ MACD é‡‘å‰äº0è½´ä¸‹ï¼Œåå¼¹ä¿¡å·");
      if (macd === "bottom-divergence") details.push("â€¢ å‡ºç°åº•èƒŒç¦»ä¿¡å·");
      if (volume === "high" && j < 30 && rsi < 50) details.push("â€¢ æ”¾é‡ä¸‹è·ŒåæŒ‡æ ‡è½å…¥ä½ä½");
      signal = "ğŸ“‰ å¤šé¡¹æŒ‡æ ‡æ˜¾ç¤ºå¸‚åœºå¤„äºç›¸å¯¹ä½ä½ï¼š\n\n" + details.join("\n") + "\n\nâœ… å¯å…³æ³¨é˜¶æ®µæ€§åå¼¹æˆ–é€¢ä½å¸çº³æœºä¼šã€‚";
    }

    // é»˜è®¤åˆ¤æ–­
    if (!isTop && !isBottom) {
      if (j <= 30 && rsi < 50) {
        signal = "ğŸ“‰ æŒ‡æ ‡åä½ï¼Œè™½ç„¶å°šæœªæç«¯ï¼Œä½†è‹¥é…åˆæˆäº¤é‡æ”¾å¤§ï¼Œå¯èƒ½å‡ºç°åå¼¹ä¿¡å·ã€‚";
      } else if (j >= 70 && rsi > 50) {
        signal = "ğŸ“ˆ æŒ‡æ ‡ç•¥åé«˜ï¼Œè‹¥æ²¡æœ‰æ”¾é‡æ”¯æŒï¼Œéœ€é˜²èŒƒå†²é«˜å›è½ã€‚";
      } else {
        signal = "ğŸ“Š å½“å‰å¸‚åœºæš‚æ— æ˜æ˜¾ä¿¡å·ï¼Œå»ºè®®è€å¿ƒè§‚å¯Ÿï¼Œä¸å®œè´¸ç„¶æ“ä½œã€‚";
      }
    }

    // MACD ç®€æ´æç¤º
    if (macd === "golden-cross-above") {
      signal += "\n\nâœ… MACD å‡ºç°é‡‘å‰ï¼ˆ0è½´ä¸Šï¼‰ï¼Œå¤šå¤´è¶‹åŠ¿å¢å¼ºã€‚";
    } else if (macd === "dead-cross" && !isTop) {
      signal += "\n\nâš ï¸ MACD æ­»å‰ï¼Œéœ€æ³¨æ„è¶‹åŠ¿è½¬å¼±é£é™©ã€‚";
    }

    let cycleText = "\nå½“å‰å‘¨æœŸï¼š";
    if (cycle === "week") cycleText += "å‘¨K (ä¸­æœŸè¶‹åŠ¿å‚è€ƒï¼Œä¿¡å·æ›´å…·å»¶ç»­æ€§)";
    else if (cycle === "hour") cycleText += "å°æ—¶K (çŸ­çº¿ä¿¡å·å‚è€ƒï¼Œæ³¢åŠ¨å¿«)";
    else cycleText += "æ—¥K (æ—¥å¸¸ä¸»å‚è€ƒï¼Œå¹³è¡¡æ³¢åŠ¨ä¸è¶‹åŠ¿)";

    resultTextBox.innerText = signal + cycleText;
    resultContainer.style.display = 'block';
    renderPreviewChart(j, rsi);
  }

  /**
   * æ¸²æŸ“å›¾è¡¨ (iOS é£æ ¼ä¼˜åŒ–ç‰ˆ)
   */
  function renderPreviewChart(j, rsi) {
    const ctx = document.getElementById('previewChart').getContext('2d');
    if (window._chartInstance) window._chartInstance.destroy();

    // --- ä» CSS å˜é‡ä¸­è·å–é¢œè‰²å’Œå­—ä½“ï¼Œç¡®ä¿é£æ ¼ç»Ÿä¸€ ---
    const computedStyle = getComputedStyle(document.documentElement);
    const iosBlue = computedStyle.getPropertyValue('--ios-blue').trim();
    const iosTextPrimary = computedStyle.getPropertyValue('--ios-text-primary').trim();
    const iosTextSecondary = computedStyle.getPropertyValue('--ios-text-secondary').trim();
    const iosTextTertiary = computedStyle.getPropertyValue('--ios-text-tertiary').trim();
    const iosBorder = computedStyle.getPropertyValue('--ios-border').trim();
    const bodyFontFamily = computedStyle.fontFamily;

    // --- åˆ›å»ºä¸€ä¸ªä»ä¸Šåˆ°ä¸‹çš„è“è‰²æ¸å˜èƒŒæ™¯ ---
    const gradient = ctx.createLinearGradient(0, 0, 0, 200);
    gradient.addColorStop(0, 'rgba(0, 122, 255, 0.3)'); // é¡¶éƒ¨é¢œè‰² (è¾ƒæµ“)
    gradient.addColorStop(1, 'rgba(0, 122, 255, 0)');   // åº•éƒ¨é¢œè‰² (é€æ˜)

    window._chartInstance = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['RSI', 'Jå€¼'],
        datasets: [{
          label: 'æŒ‡æ ‡å€¼',
          data: [rsi, j],
          fill: true,                  // å¼€å¯å¡«å……
          backgroundColor: gradient,     // åº”ç”¨æ¸å˜èƒŒæ™¯
          borderColor: iosBlue,
          borderWidth: 2.5,              // çº¿æ¡åŠ ç²—ä¸€ç‚¹
          tension: 0.4,
          pointBackgroundColor: '#FFFFFF', // æ•°æ®ç‚¹: ç™½è‰²å¡«å……
          pointBorderColor: iosBlue,     // æ•°æ®ç‚¹: è“è‰²è¾¹æ¡†
          pointBorderWidth: 2,
          pointRadius: 5,
          pointHoverRadius: 7,
          pointHoverBackgroundColor: '#FFFFFF',
          pointHoverBorderColor: iosBlue,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: { display: false },
          tooltip: {
            enabled: true,
            backgroundColor: 'rgba(249, 249, 249, 0.9)', // iOS é£æ ¼çš„æ¯›ç»ç’ƒèƒŒæ™¯
            titleFont: { size: 14, weight: '600', family: bodyFontFamily },
            titleColor: iosTextSecondary,
            bodyFont: { size: 17, weight: 'bold', family: bodyFontFamily },
            bodyColor: iosTextPrimary,
            padding: 12,
            cornerRadius: 10,
            borderColor: iosBorder,
            borderWidth: 1,
            displayColors: false, // éšè—é¢œè‰²å°æ–¹å—
            callbacks: {
              title: (tooltipItems) => tooltipItems[0].label,
              label: (context) => `å€¼ä¸º: ${context.parsed.y}`
            }
          }
        },
        scales: {
          y: {
            min: -40,
            max: 120,
            ticks: {
              stepSize: 20,
              color: iosTextTertiary,
              font: { family: bodyFontFamily, size: 12 }
            },
            grid: {
              color: iosBorder,
              border: {
                dash: [4, 4] // å°†ç½‘æ ¼çº¿å˜ä¸ºè™šçº¿
              }
            }
          },
          x: {
            ticks: {
              color: iosTextSecondary,
              font: { family: bodyFontFamily, size: 14, weight: '500' }
            },
            grid: { display: false },
            border: { display: false } // éšè—Xè½´æœ¬èº«é‚£æ¡çº¿ï¼Œæ›´ç®€æ´
          }
        }
      }
    });
  }

  // éšè—å¾®ä¿¡åˆ†äº«èœå•
  function hideWeChatShareMenu() {
    if (typeof WeixinJSBridge === "undefined") {
      if (document.addEventListener) {
        document.addEventListener('WeixinJSBridgeReady', onWeixinJSBridgeReady, false);
      } else if (document.attachEvent) {
        document.attachEvent('WeixinJSBridgeReady', onWeixinJSBridgeReady);
      }
    } else {
      onWeixinJSBridgeReady();
    }

    // å¤„ç† WeixinJSBridgeReady äº‹ä»¶ï¼Œéšè—åˆ†äº«èœå•
    function onWeixinJSBridgeReady() {
      // è°ƒç”¨ WeixinJSBridge æ¥å£éšè—èœå•é¡¹
      WeixinJSBridge.invoke('menu:setMainMenu', {
        'menuList': [
          'menuItem:share:appMessage',  // åˆ†äº«ç»™æœ‹å‹
          'menuItem:share:timeline',    // åˆ†äº«åˆ°æœ‹å‹åœˆ
          'menuItem:share:weiboApp',    // åˆ†äº«åˆ°å¾®åš
          'menuItem:favorite',          // æ”¶è—
          'menuItem:share:qzone'        // åˆ†äº«åˆ° QQ ç©ºé—´
        ]
      }, function(res) {
        if (res.err_msg === "menu:setMainMenu:ok") {
          console.log("åˆ†äº«èœå•å·²è¢«éšè—");
        }
      });
    }
  }

  hideWeChatShareMenu();

</script>
</body>
</html>
